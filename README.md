# Current Event Analyzer

一个基于PyQt5的电流事件分析工具，支持TDMS和NPZ文件格式，提供交互式数据分析和多文件数据可视化功能。

## 安装依赖

```bash
pip install -r requirements.txt
```

## 运行程序

```bash
python main.py
```

## 功能模块

### 模块1：单事件分析 (Single Event Analysis)

#### 功能特点
- 支持TDMS和NPZ文件加载
- tdms的采样频率是250khz
- 横坐标是时间，纵坐标是电流
- 交互式图表显示（可缩放、平移）
- 阈值分析和峰值检测
- 峰值审核和选择性导出
- 背景颜色自定义

#### 使用说明
1. 点击"Load TDMS/NPZ File Folder"加载数据文件夹
2. 使用Previous/Next按钮浏览不同文件
3. 设置threshold值（默认-0.1），定义峰值检测范围
4. 调整分析参数：height（默认0.02）和背景颜色
5. 点击"Analyze"进行峰值分析
6. 在"峰值审核"中选择要保存的峰值
7. 点击"Export Selected to CSV"导出选中的峰值数据
8. CSV包含：file_name, peak_number, total_time, peak_t, peak_i, peak_start_i, peak_start_t, peak_amplitude

### 模块2：多文件数据可视化 (Multi-file Data Visualization)

#### 功能特点
- 支持导入多个CSV文件
- 灵活的列选择和数据筛选
- 多种统计图表类型
- 跨文件数据对比分析
- 图表数据导出功能

#### 数据导入
- 支持批量导入CSV文件
- 自动识别CSV文件结构和列名
- 显示每个文件的数据预览和统计信息

#### 可视化类型

##### 单列可视化
- **Box Plot (箱线图)**：显示数据分布、中位数、四分位数和异常值
- **Histogram (直方图)**：显示数据频率分布
- **Violin Plot (小提琴图)**：结合密度分布和箱线图特点
- **Category Plot (分类图)**：多文件同列数据的分类对比

##### 多列可视化
- **Scatter Plot (散点图)**：两列数据的相关性分析
- **多文件对比**：不同文件用不同颜色在同一图中显示
- **趋势分析**：支持添加拟合线和相关系数

#### 交互功能
- 列选择器：下拉菜单选择要分析的列
- 文件筛选器：选择参与分析的文件
- 图表类型切换：实时切换不同的可视化方式
- 参数调整：bins数量、颜色方案等

#### 数据导出
- 导出当前显示的图表数据
- 支持多种格式：CSV、Excel
- 包含统计摘要信息
- 图表图像导出（PNG、PDF）

#### 使用流程
1. 导入多个CSV文件
2. 选择要分析的列（单列或多列）
3. 选择参与分析的文件
4. 选择可视化类型
5. 调整图表参数
6. 查看分析结果
7. 导出数据和图表

## 界面布局

### 单事件分析界面
- 左侧：文件加载 → 数据分析 → 导出结果 → 峰值审核 → 分析参数 → 分析结果
- 右侧：交互式时间-电流图表

### 多文件可视化界面
- 左侧：文件管理 → 列选择 → 图表设置 → 导出选项
- 右侧：统计图表显示区域

## 技术实现

### 核心算法
- 峰值检测：scipy.find_peaks
- 起点检测：从峰值向前寻找上升趋势结束点
- 统计分析：numpy统计函数
- 可视化：matplotlib + seaborn + pyqtgraph

### 数据格式
- 输入：TDMS文件（250kHz采样）、NPZ文件、CSV文件
- 输出：标准化CSV格式，包含完整的峰值分析数据

## 多文件可视化详细规格

### 界面组件设计
```
左侧控制面板:
├── 文件管理
│   ├── 导入CSV文件按钮
│   ├── 文件列表（带复选框）
│   └── 文件预览区域
├── 数据选择
│   ├── 列选择下拉菜单（支持多选）
│   ├── 单列/多列模式切换
│   └── 数据类型显示
├── 图表设置
│   ├── 图表类型选择器
│   ├── 颜色方案选择
│   ├── bins数量调整（直方图）
│   └── 图表尺寸设置
└── 导出选项
    ├── 导出当前数据
    ├── 导出统计摘要
    └── 导出图像文件
```

### 可视化逻辑

#### 单列分析逻辑
1. **数据预处理**：合并选中文件的指定列数据
2. **统计计算**：计算基本统计量（均值、标准差、分位数）
3. **图表绘制**：
   - Box Plot：使用seaborn.boxplot，按文件分组
   - Histogram：使用matplotlib.hist，可选择bins数量
   - Violin Plot：使用seaborn.violinplot，显示密度分布
   - Category Plot：使用seaborn.catplot，多文件对比

#### 多列分析逻辑
1. **数据配对**：选择X轴和Y轴列
2. **相关性分析**：计算皮尔逊相关系数
3. **散点图绘制**：
   - 不同文件用不同颜色和标记
   - 可选添加拟合线
   - 显示相关系数和R²值

### 数据导出规格
- **数据导出**：包含文件名、选中列数据、统计信息
- **图像导出**：支持PNG（高分辨率）、PDF（矢量格式）
- **统计摘要**：包含每个文件的描述性统计、组间比较结果